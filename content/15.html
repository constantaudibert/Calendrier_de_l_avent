<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15 Décembre - Chasse au Daron</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Satisfy&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: transparent;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100%;
            margin: 0;
            overflow: hidden;
            text-align: center;
            touch-action: manipulation;
            /* Flex layout to center perfectly */
            flex-direction: column;
            justify-content: center;
        }

        h1 {
            font-family: 'Satisfy', cursive;
            font-size: 2em;
            margin-bottom: 20px;
            color: #d4af37;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .stats-bar {
            display: flex;
            gap: 30px;
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 300px;
            height: 300px;
            margin: 0 auto;
        }

        .hole {
            background-color: #3e2723;
            /* Dark brown/dirt */
            border: 4px solid #d4af37;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 10px 20px rgba(0, 0, 0, 0.8);
            cursor: pointer;
        }

        /* The Mole Image */
        .mole {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 100%;
            /* Hidden initially */
            left: 0;
            transition: top 0.1s;
            object-fit: cover;
            border-radius: 50%;
            pointer-events: none;
            /* Let click pass to hole if needed, but we handle click on hole mostly */
        }

        /* Class to show mole */
        .hole.up .mole {
            top: 0;
            pointer-events: auto;
            /* Clickable when up */
        }

        .start-btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 1.5em;
            font-family: 'Satisfy', cursive;
            background: #d4af37;
            border: none;
            border-radius: 50px;
            color: #000;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
        }

        .start-btn:disabled {
            background: #555;
            color: #888;
            cursor: default;
        }

        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            color: #333;
            padding: 20px;
            border: 4px solid #d4af37;
            border-radius: 10px;
            display: none;
            z-index: 100;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
        }

        #end-title {
            color: #d4af37;
            font-family: 'Satisfy', cursive;
            font-size: 3em;
            margin: 0;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.1);
        }

        /* Animations for hits */
        @keyframes hitPop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
            }
        }

        .hole:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body>

    <h1>Attrape "Madame Ducoup" !</h1>

    <div class="stats-bar">
        <div>Du coup: <span id="score">0</span></div>
        <div>Temps: <span id="time-left">20</span>s</div>
    </div>

    <div class="game-grid">
        <div class="hole" id="hole1">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole2">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole3">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole4">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole5">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole6">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole7">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole8">
            <div class="mole"></div>
        </div>
        <div class="hole" id="hole9">
            <div class="mole"></div>
        </div>
    </div>

    <button class="start-btn" onclick="startGame()">JOUER !</button>

    <div class="message" id="end-msg">
        <h2 id="end-title">Terminé !</h2>
        <p>Ton score : <span id="final-score">0</span></p>
        <button class="start-btn" onclick="closeMsg()">Fermer</button>
    </div>

    <audio id="bonk-success" src="images/ducoup.mp3"></audio>
    <audio id="bonk-loss" src="images/wrong.mp3"></audio>

    <script>
        const holes = document.querySelectorAll('.hole');
        const scoreBoard = document.querySelector('#score');
        const timeBoard = document.querySelector('#time-left');
        const moles = document.querySelectorAll('.mole');
        const endMsg = document.getElementById('end-msg');

        let lastHole;
        let timeUp = false;
        let score = 0;
        let timeLeft = 20;
        let gameTimer;
        let peepTimer;

        // Assets
        const goodMole = 'images/madame_ducoup_bottom.png';
        const badMole = 'images/le_parisien.jpeg';

        // Audio
        const audioSuccess = document.getElementById('bonk-success');
        const audioWrong = document.getElementById('bonk-loss');
        const winSound = new Audio('images/victoire.mp3');

        function randomTime(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) {
                return randomHole(holes);
            }
            lastHole = hole;
            return hole;
        }

        function peep() {
            const time = randomTime(500, 1000); // Speed
            const hole = randomHole(holes);

            // Determine playing character: 80% Madame Ducoup, 20% Trap
            const isTrap = Math.random() > 0.8;
            const moleImg = hole.querySelector('.mole');

            // Set image
            if (isTrap) {
                moleImg.style.backgroundImage = `url('${badMole}')`;
                moleImg.style.backgroundSize = 'cover';
                hole.dataset.type = 'bad';
            } else {
                moleImg.style.backgroundImage = `url('${goodMole}')`;
                moleImg.style.backgroundSize = 'contain'; /* PNG might need contain to be seen fully */
                moleImg.style.backgroundRepeat = 'no-repeat';
                moleImg.style.backgroundPosition = 'center';
                hole.dataset.type = 'good';
            }

            hole.classList.add('up');

            setTimeout(() => {
                hole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }

        function startGame() {
            scoreBoard.textContent = 0;
            timeBoard.textContent = 20;
            score = 0;
            timeLeft = 20;
            timeUp = false;
            endMsg.style.display = 'none';
            document.querySelector('.start-btn').disabled = true;

            peep();

            gameTimer = setInterval(() => {
                timeLeft--;
                timeBoard.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(gameTimer);
                    timeUp = true;
                    endGame();
                }
            }, 1000);
        }

        function wack(e) {
            if (!e.isTrusted) return; // cheater!

            const hole = this;
            if (!hole.classList.contains('up')) return; // Already down

            if (hole.dataset.type === 'good') {
                score++;
                // Visual feedback green
                hole.style.borderColor = '#2ecc71';
                // Audio
                audioSuccess.currentTime = 0;
                audioSuccess.play();
            } else {
                score -= 2; // Penalty
                // Visual feedback red
                hole.style.borderColor = '#e74c3c';
                // Audio
                audioWrong.currentTime = 0;
                audioWrong.play();
            }

            scoreBoard.textContent = score;
            hole.classList.remove('up');

            // Reset border color after delay
            setTimeout(() => {
                hole.style.borderColor = '#d4af37';
            }, 200);
        }

        function endGame() {
            document.querySelector('.start-btn').disabled = false;
            document.getElementById('final-score').textContent = score;
            endMsg.style.display = 'block';

            if (score > 5) {
                winSound.play();
                document.getElementById('end-title').textContent = "Du coup, Bravo !";
            } else {
                document.getElementById('end-title').textContent = "Du coup, Peut mieux faire...";
            }
        }

        function closeMsg() {
            endMsg.style.display = 'none';
            winSound.pause();
            winSound.currentTime = 0;
        }

        holes.forEach(hole => hole.addEventListener('mousedown', wack));
        holes.forEach(hole => hole.addEventListener('touchstart', wack)); // Mobile support

    </script>
</body>

</html>